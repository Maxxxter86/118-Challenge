<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f0f0f" />
  <meta name="description" content="118 Challenge 2026 ¬∑ Tracker" />
  <title>118 Challenge 2026</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="118 Challenge" />

  <style>
    :root{
      --bg:#0f0f0f;
      --card:#151515;
      --text:#f5f5f5;
      --muted:#b7b7b7;
      --line:rgba(255,255,255,.12);
      --good:#4ade80;
      --warn:#fbbf24;
      --bad:#fb7185;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(74,222,128,.12), transparent 60%),
        radial-gradient(1200px 700px at 80% 30%, rgba(251,191,36,.10), transparent 60%),
        radial-gradient(1200px 700px at 50% 90%, rgba(251,113,133,.10), transparent 60%),
        var(--bg);
      min-height:100vh;
      padding:18px;
      display:flex;
      justify-content:center;
    }
    .wrap{width:min(620px, 100%)}
    .header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin:10px 0 14px;
    }
    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.3px;
    }
    .sub{
      color:var(--muted);
      font-size:13px;
      margin-top:4px;
    }
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
      background:rgba(255,255,255,.03);
      white-space:nowrap;
    }
    .card{
      background:rgba(21,21,21,.82);
      border:1px solid var(--line);
      border-radius:18px;
      padding:16px;
      box-shadow: 0 14px 35px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      margin:12px 0;
    }
    .big{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .count{
      font-size:44px;
      font-weight:800;
      line-height:1;
      letter-spacing:.5px;
    }
    .count small{font-size:18px; color:var(--muted); font-weight:600}
    .pct{
      font-size:18px;
      color:var(--muted);
      font-weight:700;
    }
    .bar{
      height:14px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      overflow:hidden;
      margin:14px 0 8px;
    }
    .fill{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(74,222,128,.95), rgba(251,191,36,.95), rgba(251,113,133,.95));
      transition: width .35s ease;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .mini{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.03);
    }
    .mini .label{
      color:var(--muted);
      font-size:12px;
      margin-bottom:6px;
    }
    .mini .value{
      font-size:18px;
      font-weight:750;
    }
    .actions{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    button{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      border-radius:14px;
      padding:12px 10px;
      font-size:15px;
      font-weight:750;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease;
      user-select:none;
    }
    button:active{transform: scale(.98)}
    .primary{background: rgba(74,222,128,.10)}
    .danger{background: rgba(251,113,133,.10)}
    .ghost{background: rgba(255,255,255,.02); color:var(--muted)}
    .footer{
      color:var(--muted);
      font-size:12px;
      margin-top:10px;
      line-height:1.35;
    }
    .log{
      margin-top:10px;
      max-height:200px;
      overflow:auto;
      border-top:1px solid var(--line);
      padding-top:10px;
    }
    .log-item{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:8px 0;
      border-bottom:1px dashed rgba(255,255,255,.10);
      font-size:13px;
    }
    .tag{
      font-size:11px;
      border:1px solid rgba(255,255,255,.16);
      color:var(--muted);
      padding:4px 8px;
      border-radius:999px;
      white-space:nowrap;
    }
    .note{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    input[type="text"]{
      flex:1;
      min-width:210px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
    }
    .smallbtn{
      padding:10px 12px;
      font-size:13px;
      border-radius:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>118 Challenge ¬∑ 2026</h1>
        <div class="sub">118 entrenos. 1 a√±o. Juntos.</div>
      </div>
      <div class="pill" id="todayPill">üìÖ ‚Äî</div>
    </div>

    <div class="card">
      <div class="big">
        <div class="count"><span id="done">2</span><small> / <span id="goal">118</span></small></div>
        <div class="pct" id="pct">1,7%</div>
      </div>

      <div class="bar" aria-label="Progreso">
        <div class="fill" id="fill"></div>
      </div>

      <div class="row">
        <div class="mini">
          <div class="label">üéØ Objetivo del mes</div>
          <div class="value" id="monthGoal">‚Äî</div>
        </div>
        <div class="mini">
          <div class="label">‚úÖ Hechos este mes</div>
          <div class="value" id="monthDone">‚Äî</div>
        </div>
      </div>

      <div class="actions">
        <button class="primary" id="plus">‚ûï +1 entreno</button>
        <button class="danger" id="minus">‚ûñ -1</button>
        <button class="ghost" id="resetMonth">‚Ü∫ Reiniciar mes</button>
      </div>

      <div class="note">
        <input id="note" type="text" placeholder="Nota opcional (p.ej. 'fuerza + paseo', 'carrera suave'‚Ä¶)" maxlength="60" />
        <button class="smallbtn" id="addWithNote">üìù +1 con nota</button>
      </div>

      <div class="footer">
        üíæ Se guarda en tu m√≥vil (local). Funciona offline.  
        Tip: a√±adidlo a la pantalla de inicio para usarlo como ‚Äúapp‚Äù.
      </div>

      <div class="log" id="log"></div>
    </div>

    <div class="card">
      <div class="mini" style="margin:0">
        <div class="label">‚öôÔ∏è Ajustes r√°pidos</div>
        <div class="footer" style="margin:6px 0 0">
          ‚Ä¢ El a√±o objetivo est√° fijado a <b>2026</b> y el objetivo a <b>118</b>.  
          ‚Ä¢ Puedes borrar todo el historial si lo necesitas.
        </div>
        <div class="actions" style="grid-template-columns:1fr 1fr; margin-top:10px">
          <button class="ghost" id="wipe">üßπ Borrar todo</button>
          <button class="ghost" id="export">‚¨áÔ∏è Exportar JSON</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Config ---
    const YEAR = 2026;
    const GOAL = 118;

    // Distribuci√≥n mensual "proporcionada" (la que ya estabais usando)
    const monthTargets = {
      0:10, 1:9, 2:10, 3:9, 4:10, 5:9, 6:10, 7:9, 8:10, 9:10, 10:9, 11:13
    };

    // --- Storage keys ---
    const K = {
      total: "c118_total_" + YEAR,
      log: "c118_log_" + YEAR,
      month: (m)=> "c118_month_" + YEAR + "_" + m
    };

    // --- Helpers ---
    const fmtPct = (x)=> (Math.round(x*10)/10).toString().replace(".", ",") + "%";
    const pad2 = (n)=> String(n).padStart(2,"0");
    const today = ()=> new Date();
    const monthIdx = ()=> today().getMonth();
    const dateStamp = ()=> {
      const d = today();
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    };

    function loadInt(key, fallback=0){
      const v = localStorage.getItem(key);
      const n = v===null ? fallback : parseInt(v,10);
      return Number.isFinite(n) ? n : fallback;
    }
    function saveInt(key, value){
      localStorage.setItem(key, String(value));
    }
    function loadLog(){
      try{
        const v = localStorage.getItem(K.log);
        return v ? JSON.parse(v) : [];
      }catch(e){ return []; }
    }
    function saveLog(arr){
      localStorage.setItem(K.log, JSON.stringify(arr));
    }

    // --- Initialize defaults (your current state) ---
    function ensureInit(){
      if(localStorage.getItem(K.total) === null){
        saveInt(K.total, 2); // ya llev√°is 2 entrenos
      }
      const m = monthIdx();
      if(localStorage.getItem(K.month(m)) === null){
        saveInt(K.month(m), 2); // asumimos que esos 2 son de enero; si no, se ajusta con 2 taps :)
      }
      if(localStorage.getItem(K.log) === null){
        const initLog = [
          {date: dateStamp(), delta: +1, note:""},
          {date: dateStamp(), delta: +1, note:""}
        ];
        saveLog(initLog);
      }
    }

    // --- UI update ---
    function updateUI(){
      const totalDone = loadInt(K.total, 0);
      const m = monthIdx();
      const mDone = loadInt(K.month(m), 0);
      const mGoal = monthTargets[m] ?? 0;

      document.getElementById("done").textContent = totalDone;
      document.getElementById("goal").textContent = GOAL;

      const pct = (totalDone / GOAL) * 100;
      document.getElementById("pct").textContent = fmtPct(pct);
      document.getElementById("fill").style.width = Math.min(100, Math.max(0, pct)) + "%";

      const monthNames = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
      document.getElementById("monthGoal").textContent = `${mGoal} (${monthNames[m]})`;
      document.getElementById("monthDone").textContent = `${mDone}`;

      const d = today();
      document.getElementById("todayPill").textContent =
        `üìÖ ${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()}`;

      renderLog();
    }

    function renderLog(){
      const log = loadLog().slice().reverse();
      const el = document.getElementById("log");
      if(log.length === 0){
        el.innerHTML = `<div class="footer">Sin historial todav√≠a.</div>`;
        return;
      }
      el.innerHTML = log.map(item=>{
        const sign = item.delta > 0 ? "‚úÖ +1" : "‚ùå -1";
        const note = item.note ? ` ¬∑ ${escapeHtml(item.note)}` : "";
        return `
          <div class="log-item">
            <div>${escapeHtml(item.date)}${note}</div>
            <span class="tag">${sign}</span>
          </div>
        `;
      }).join("");
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
      }[s]));
    }

    function add(delta, note=""){
      const totalDone = loadInt(K.total, 0);
      const m = monthIdx();
      const mDone = loadInt(K.month(m), 0);

      const newTotal = Math.max(0, totalDone + delta);
      const newMonth = Math.max(0, mDone + delta);

      saveInt(K.total, newTotal);
      saveInt(K.month(m), newMonth);

      const log = loadLog();
      log.push({ date: dateStamp(), delta, note: note || "" });
      saveLog(log);

      updateUI();
    }

    // --- Events ---
    ensureInit();
    updateUI();

    document.getElementById("plus").addEventListener("click", ()=> add(+1));
    document.getElementById("minus").addEventListener("click", ()=> add(-1));

    document.getElementById("addWithNote").addEventListener("click", ()=>{
      const input = document.getElementById("note");
      const note = input.value.trim();
      add(+1, note);
      input.value = "";
    });

    document.getElementById("resetMonth").addEventListener("click", ()=>{
      const m = monthIdx();
      saveInt(K.month(m), 0);
      updateUI();
    });

    document.getElementById("wipe").addEventListener("click", ()=>{
      // Borra todo el a√±o
      Object.keys(localStorage).forEach(k=>{
        if(k.startsWith("c118_") && k.includes("_" + YEAR)){
          localStorage.removeItem(k);
        }
      });
      // Reinicia a 0
      saveInt(K.total, 0);
      saveLog([]);
      updateUI();
    });

    document.getElementById("export").addEventListener("click", ()=>{
      const m = monthIdx();
      const payload = {
        year: YEAR,
        goal: GOAL,
        total: loadInt(K.total, 0),
        monthIndex: m,
        monthGoal: monthTargets[m] ?? 0,
        monthDone: loadInt(K.month(m), 0),
        log: loadLog()
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `118-challenge-${YEAR}-export.json`;
      a.click();
      setTimeout(()=> URL.revokeObjectURL(url), 500);
    });

    // --- PWA lite: register a tiny service worker from a blob ---
    // Esto permite offline sin archivos extra.
    if("serviceWorker" in navigator){
      const swCode = `
        const CACHE = "c118-${YEAR}-v1";
        self.addEventListener("install", e=>{
          e.waitUntil((async()=>{
            const cache = await caches.open(CACHE);
            cache.addAll(["./"]);
            self.skipWaiting();
          })());
        });
        self.addEventListener("activate", e=>{
          e.waitUntil(self.clients.claim());
        });
        self.addEventListener("fetch", e=>{
          e.respondWith((async()=>{
            const cached = await caches.match(e.request);
            return cached || fetch(e.request);
          })());
        });
      `;
      const blob = new Blob([swCode], {type:"text/javascript"});
      const swUrl = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swUrl).catch(()=>{});
    }
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js");
    });
  }
</script>
</body>
</html>
